var Vr=pc.createScript("vr");Vr.attributes.add("buttonVr",{type:"entity",title:"VR Button"}),Vr.attributes.add("elementUnsupported",{type:"entity",title:"Unsupported Message"}),Vr.attributes.add("elementHttpsRequired",{type:"entity",title:"HTTPS Required Message"}),Vr.attributes.add("cameraEntity",{type:"entity",title:"Camera"}),Vr.prototype.initialize=function(){this.app.xr.on("available:"+pc.XRTYPE_VR,this.checkButton,this),this.app.xr.on("start",this.checkButton,this),this.app.xr.on("end",this.checkButton,this),this.buttonVr.element.on("click",function(){this.sessionStart()},this),this.app.keyboard.on("keydown",function(t){t.key===pc.KEY_ESCAPE&&this.app.xr.active&&this.app.xr.end()},this),this.checkButton()},Vr.prototype.checkButton=function(){if(this.app.xr.supported)if(this.elementHttpsRequired.enabled=!1,this.elementUnsupported.enabled=!1,this.app.xr.active)this.buttonVr.enabled=!1;else{this.buttonVr.enabled=!0;var t=this.app.xr&&!this.app.xr.active&&this.app.xr.isAvailable(pc.XRTYPE_VR);this.buttonVr.element.opacity=t?.2:.1,this.buttonVr.children[0].element.opacity=t?1:.2}else this.buttonVr.enabled=!1,"https:"==window.location.protocol?(this.elementUnsupported.enabled=!0,this.elementHttpsRequired.enabled=!1):(this.elementUnsupported.enabled=!1,this.elementHttpsRequired.enabled=!0)},Vr.prototype.sessionStart=function(){this.app.xr.supported&&(this.app.xr.active||this.app.xr.isAvailable(pc.XRTYPE_VR)&&this.cameraEntity.camera.startXr(pc.XRTYPE_VR,pc.XRSPACE_LOCAL))};var Controllers=pc.createScript("controllers");Controllers.attributes.add("controllerTemplate",{type:"entity",title:"Controller Template"}),Controllers.attributes.add("cameraParent",{type:"entity",title:"Camera Parent"}),Controllers.prototype.initialize=function(){this.app.xr.input.on("add",function(t){var e=this.controllerTemplate.clone();e.script.controller.setInputSource(t),e.reparent(this.cameraParent),e.enabled=!0},this)};var Controller=pc.createScript("controller");Controller.prototype.initialize=function(){this.RAD_TO_DEG=360/(2*Math.PI),this.vecA=new pc.Vec3,this.vecB=new pc.Vec3,this.matA=new pc.Mat4,this.quat=new pc.Quat,this.color=new pc.Color(1,1,1),this.modelEntity=this.entity.findByName("model"),this.hoverEntity=null,this.targetPointerSize=2,this.targetTeleportable=!1,this.pointer=this.entity.findByName("pointer"),this.pointer.element.material.depthTest=!1,this.hoverPoint=new pc.Vec3,this.pointerDistance=3,this.gridHoverPoint=new pc.Vec3,this.grabbing=!1,this.squeezing=!1,this.displayingStack=!1,this.lastScrollPoint=null,this.curScrollPoint=null,this.gridHoverPointTestEntity=this.app.root.findByName("Test2"),this.cameraEntity=this.app.root.findByName("Camera"),this.previous=void 0,this.gazeRay=new pc.Ray,this.gazeVec3A=new pc.Vec3,this.gazeVec3B=new pc.Vec3,this.stackable=!1,this.app.on("isstackable",this.isStackable,this)},Controller.prototype.setInputSource=function(t){this.inputSource=t,this.inputSource.once("remove",this.onRemove,this),this.on("hover",this.onHover,this),this.on("blur",this.onBlur,this),this.inputSource.on("select",this.onSelect,this),this.inputSource.on("selectstart",this.onSelectStart,this),this.inputSource.on("selectend",this.onSelectEnd,this),this.app.on("setgridhover",this.setGridHover,this),this.app.on("setscrollpoint",this.setScrollPoint,this),this.app.on("setdisplayingstack",this.setDisplayingStack,this),this.app.on("controller:move",this.controllerMove,this),this.app.on("controller:rotate",this.controllerRotate,this)},Controller.prototype.setGridHover=function(t){this.gridHoverPoint.copy(t)},Controller.prototype.setDisplayingStack=function(t){this.displayingStack=t},Controller.prototype.setScrollPoint=function(t){this.curScrollPoint=new pc.Vec3,this.curScrollPoint.copy(t)},Controller.prototype.onRemove=function(){this.entity.destroy()},Controller.prototype.onSelect=function(){if(this.app.fire("object:pick",this),this.hoverEntity)if(this.targetTeleportable)this.app.fire("controller:teleport",this.hoverPoint);else if(this.hoverEntity.tags.has("interactive")){var t=this.hoverEntity.model.meshInstances[0];t.pickedColor||(t.pickedColor=new pc.Color),t.pickedColor.set(Math.random(),Math.random(),Math.random()),t.setParameter("material_diffuse",t.pickedColor.data3)}},Controller.prototype.onSelectStart=function(){this.hoverEntity&&(this.grabbing=!0,this.displayingStack&&this.app.fire("showmaingrid"),this.app.fire("deactivatezoom",this.hoverEntity,this))},Controller.prototype.onSelectEnd=function(){this.grabbing=!1,this.app.fire("handlecontrollerrelease",this.hoverEntity),this.app.fire("activatezoom")},Controller.prototype.onHover=function(t,i){this.hoverEntity=t,this.hoverPoint.copy(i),this.targetPointerSize=16,this.targetTeleportable=this.hoverEntity.tags.has("teleportable")},Controller.prototype.onBlur=function(){this.hoverEntity=null,this.targetPointerSize=4,this.targetTeleportable=!1},Controller.prototype.isStackable=function(t){this.isStackable=t},Controller.prototype.update=function(t){if(this.grabbing||(this.app.fire("object:pick",this),this.hoverEntity&&this.hoverEntity.tags.has("stack")&&this.hoverEntity.position.distance(this.hoverPoint)),this.inputSource.grip&&(this.modelEntity.enabled=!0,this.entity.setPosition(this.inputSource.getPosition()),this.entity.setRotation(this.inputSource.getRotation()),this.vecA.copy(this.inputSource.getOrigin()),this.vecB.copy(this.inputSource.getDirection()),this.vecB.scale(1e3).add(this.vecA),this.inputSource.selecting?this.color.set(0,1,0):this.color.set(1,1,1),this.app.renderLine(this.vecA,this.vecB,this.color)),this.hoverEntity){var i=this.vecA.copy(this.hoverPoint).sub(this.inputSource.getOrigin()).length();this.pointerDistance+=.3*(i-this.pointerDistance)}this.vecA.copy(this.inputSource.getDirection()).scale(this.pointerDistance).add(this.inputSource.getOrigin()),this.pointer.setPosition(this.vecA);var e=this.targetPointerSize*(this.targetTeleportable?8:1);this.pointer.element.width!==e&&(this.pointer.element.width+=.3*(e-this.pointer.element.width),Math.abs(this.pointer.element.width-e)<=1&&(this.pointer.element.width=e),this.pointer.element.height=this.pointer.element.width);var o=this.inputSource.gamepad;if(o&&(this.inputSource.handedness===pc.XRHAND_LEFT&&Math.abs(o.axes[0])+Math.abs(o.axes[1])>.4?this.app.fire("controller:move",o.axes[0],o.axes[1],t):this.inputSource.handedness===pc.XRHAND_RIGHT&&Math.abs(o.axes[0])>.35&&this.app.fire("controller:rotate",-o.axes[0],t),o.buttons[1].pressed?this.squeezing=!0:(this.squeezing=!1,this.lastScrollPoint=null,this.curScrollPoint=null),!this.displayingStack&&o.buttons[2].pressed&&this.hoverEntity&&this.hoverEntity.isStack&&(this.displayingStack=!0,this.app.fire("setdisplayingstack",!0),this.app.fire("displaystack",this.hoverEntity))),this.grabbing){if(this.app.fire("object:controllergridhover",this),this.gridHoverPoint&&this.hoverEntity){if(this.stackable&&console.log("stackable"),!this.stackable){this.hoverEntity.setPosition(this.gridHoverPoint.x,this.gridHoverPoint.y,this.gridHoverPoint.z);var s=Math.atan2(this.gridHoverPoint.x,this.gridHoverPoint.z);s=this.RAD_TO_DEG*s,this.hoverEntity.setLocalEulerAngles(90,s+180,0)}this.app.fire("checkcanstack",this.hoverEntity,this.gridHoverPoint)}}else this.squeezing&&(this.app.fire("object:scrollerspherehover",this),this.curScrollPoint&&(this.lastScrollPoint&&this.app.fire("updatescroll",this.curScrollPoint,this.lastScrollPoint),this.lastScrollPoint=new pc.Vec3,this.lastScrollPoint.copy(this.curScrollPoint)))};var ObjectPicker=pc.createScript("objectPicker");ObjectPicker.prototype.initialize=function(){this.pickableEntities=this.app.root.findByTag("pickable"),this.controllerRay=new pc.Ray,this.controllerVec3A=new pc.Vec3,this.controllerVec3B=new pc.Vec3,this.controllerVec3C=new pc.Vec3,this.controllerVec3D=new pc.Vec3,this.gazeRay=new pc.Ray,this.gazeVec3A=new pc.Vec3,this.gazeVec3B=new pc.Vec3,this.app.on("object:pick",this.pick,this),this.app.on("object:gaze",this.gaze,this),this.app.on("object:controllergridhover",this.controllerGridHover,this),this.app.on("object:scrollerspherehover",this.scrollerSphereHover,this),this.app.on("object:reload",this.reloadEntities,this)},ObjectPicker.prototype.reloadEntities=function(){this.pickableEntities=this.app.root.findByTag("pickable"),this.gridColliderCylinder=this.app.root.findByName("GridCollisionCylinder")},ObjectPicker.prototype.pick=function(e){var i=null,t=1/0,r=e.inputSource.getOrigin(),o=new pc.Vec3;o.add2(r,e.inputSource.getDirection().scale(10));for(var c=this.app.systems.rigidbody.raycastAll(r,o),n=0;n<c.length;n++)if(c[n].entity.tags.has("pickable")){var p=c[n].point.distance(r);p<t&&(t=p,i=c[n])}i?e.fire("hover",i.entity,i.point):e.hoverEntity&&e.fire("blur")},ObjectPicker.prototype.gaze=function(e,i,t){for(var r=this.app.systems.rigidbody.raycastAll(t,i),o=(this.gridColliderCylinder.model.meshInstances[0],0);o<r.length;o++)if("GridCollisionCylinder"==r[o].entity.name)return void e.fire("hover",this.gridColliderCylinder,r[o].point)},ObjectPicker.prototype.controllerGridHover=function(e){var i=e.inputSource.getOrigin(),t=new pc.Vec3;t.copy(i),t.add(e.inputSource.getDirection().scale(10));for(var r=this.app.systems.rigidbody.raycastAll(t,i),o=!1,c=0;c<r.length;c++)"GridCollisionCylinder"==r[c].entity.name?this.app.fire("setgridhover",r[c].point):r[c].entity.name.startsWith("HighlightObject")&&(this.app.fire("activatehighlight",r[c].entity),o=!0);o||this.app.fire("deactivatehighlight")},ObjectPicker.prototype.scrollerSphereHover=function(e){var i=e.inputSource.getOrigin(),t=new pc.Vec3;t.copy(i),t.add(e.inputSource.getDirection().scale(10));for(var r=this.app.systems.rigidbody.raycastAll(t,i),o=0;o<r.length;o++)"ScrollerSphere"==r[o].entity.name&&this.app.fire("setscrollpoint",r[o].point)};var CameraController=pc.createScript("camera-controller");CameraController.attributes.add("height",{type:"number",default:0,placeholder:"m",title:"Height from Floor"}),CameraController.attributes.add("movementSpeed",{type:"number",default:1.5,placeholder:"m/s",title:"Movement Speed"}),CameraController.attributes.add("rotateSpeed",{type:"number",default:45,placeholder:"Â°",title:"Rotation Speed"}),CameraController.attributes.add("rotateThreshold",{type:"number",default:.5,min:0,max:1,title:"Rotation thumbstick threshold"}),CameraController.attributes.add("rotateResetThreshold",{type:"number",default:.25,min:0,max:1,title:"Rotation thumbstick reset threshold"}),CameraController.attributes.add("camera",{type:"entity",title:"Camera Entity"}),CameraController.prototype.initialize=function(){this.vec2A=new pc.Vec2,this.vec2B=new pc.Vec2,this.vec3A=new pc.Vec3,this.lastRotate=0,this.lastRotateValue=0,this.app.on("controller:teleport",this.onTeleport,this),this.app.on("controller:move",this.onMove,this),this.app.on("controller:rotate",this.onRotate,this),this.gridEntity=this.app.root.findByName("GridEntity"),this.gridEntity.setPosition(0,this.entity.getPosition().y,0)},CameraController.prototype.onTeleport=function(t){this.app.xr.type!==pc.XRTYPE_AR&&(this.vec3A.copy(this.camera.getLocalPosition()).scale(-1),this.entity.setPosition(t),this.entity.translate(0,this.height,0),this.entity.translateLocal(this.vec3A))},CameraController.prototype.onMove=function(t,e,i){if(this.vec2A.set(t,e),this.vec2A.length()){this.vec2A.normalize(),this.vec2B.x=this.camera.forward.x,this.vec2B.y=this.camera.forward.z,this.vec2B.normalize();var o=Math.atan2(this.vec2B.x,this.vec2B.y)-Math.PI/2,a=this.vec2A.x*Math.sin(o)-this.vec2A.y*Math.cos(o);this.vec2A.y=this.vec2A.y*Math.sin(o)+this.vec2A.x*Math.cos(o),this.vec2A.x=a,this.vec2A.scale(this.movementSpeed),this.entity.translate(this.vec2A.x*i,0,this.vec2A.y*i)}},CameraController.prototype.onRotate=function(t,e){this.entity.rotateLocal(0,t*e*this.rotateSpeed,0)};var mainGrid,curGrid,LoadFiles=pc.createScript("loadFiles"),NUM_TEST_FILES=20,RAD_TO_DEG=360/(2*Math.PI),GRID_RADIUS=4,IMAGE_ASSETS=null,STACK_FRAME_MATERIAL=null,HIGHLIGHT_MATERIAL_HORIZONTAL=null,HIGHLIGHT_MATERIAL_VERTICAL=null,STACK_COUNTER_FONT=null,NUM_FILES_CIRCUMFERENCE=10,NUM_FILES_VERT=4,HORIZ_SPACE_BETWEEN_FILES=.5,VERT_SPACE_BETWEEN_FILES=.5,GRID_CIRCUMFERENCE=2*Math.PI*GRID_RADIUS,WIDTH_FOR_FILE_AND_MARGIN=GRID_CIRCUMFERENCE/NUM_FILES_CIRCUMFERENCE,HEIGHT_FOR_FILE_AND_MARGIN=WIDTH_FOR_FILE_AND_MARGIN,HORIZ_FILE_MARGIN=.2*WIDTH_FOR_FILE_AND_MARGIN,VERT_FILE_MARGIN=.2*HEIGHT_FOR_FILE_AND_MARGIN,MAX_FILE_WIDTH=.8*WIDTH_FOR_FILE_AND_MARGIN,MAX_FILE_HEIGHT=.8*HEIGHT_FOR_FILE_AND_MARGIN,HORIZ_DEGREE_BETWEEN_FILES=2*Math.PI/NUM_FILES_CIRCUMFERENCE,HORIZ_BETWEEN_FILES_HIGHLIGHTING_WIDTH=.7*HORIZ_FILE_MARGIN,HORIZ_BETWEEN_FILES_HIGHLIGHTING_HEIGHT=.95*MAX_FILE_HEIGHT,VERT_BETWEEN_FILES_HIGHLIGHTING_WIDTH=.95*MAX_FILE_WIDTH,VERT_BETWEEN_FILES_HIGHLIGHTING_HEIGHT=.7*VERT_FILE_MARGIN,HORIZ_BETWEEN_FILES_HIGHLIGHTING_COLLIDER_WIDTH=.7*HORIZ_FILE_MARGIN,HORIZ_BETWEEN_FILES_HIGHLIGHTING_COLLIDER_HEIGHT=.95*MAX_FILE_HEIGHT,VERT_BETWEEN_FILES_HIGHLIGHTING_COLLIDER_WIDTH=.95*MAX_FILE_WIDTH,VERT_BETWEEN_FILES_HIGHLIGHTING_COLLIDER_HEIGHT=.7*VERT_FILE_MARGIN,gridVertOffset=0,gridHorizOffset=0,GRID_HORIZ_SCROLL_MULTIPLIER=.1,MAX_RING_Y=NUM_FILES_VERT/2*HEIGHT_FOR_FILE_AND_MARGIN,MIN_RING_Y=-MAX_RING_Y,GRID_HEIGHT=MAX_RING_Y-MIN_RING_Y,GAZE_RAY_LENGTH=Math.max(GRID_HEIGHT/4,GRID_RADIUS),MAX_ZOOM_DISTANCE=12,ZOOM_BASE=1.7,ZOOM_BASE_MULT=1.6,MIN_ZOOM_MULT=.3,rings=[],tempStackGrid=[],tempStackRings=[];LoadFiles.prototype.initialize=function(){this.gridEntity=this.app.root.findByName("GridEntity"),this.gridAxis=this.gridEntity.findByName("GridAxis"),this.gridCollisionCylinder=new pc.Entity("GridCollisionCylinder"),this.gridCollisionCylinder.addComponent("model",{type:"cylinder"}),this.gridCollisionCylinder.addComponent("collision",{type:"cylinder",radius:GRID_RADIUS,height:GRID_HEIGHT}),this.gridCollisionCylinder.model.meshInstances[0].material=new pc.StandardMaterial,this.gridCollisionCylinder.model.meshInstances[0].material.cull=pc.CULLFACE_FRONTANDBACK,this.gridCollisionCylinder.model.meshInstances[0].material.update(),this.gridAxis.addChild(this.gridCollisionCylinder),this.gridCollisionCylinder.setLocalScale(GRID_RADIUS/.5,GRID_HEIGHT,GRID_RADIUS/.5),this.cameraEntity=this.app.root.findByName("Camera"),this.gazeHoverEntity=null,this.gazeHoverPoint=new pc.Vec3,this.gazeVecA=new pc.Vec3,this.gazeVecB=new pc.Vec3,this.previous=void 0,this.highlightObj=null,this.grabbedEntity=null,this.zoomActive=!0,this.isStackable=!1,this.focusedFile=null,this.closestFile=null,this.grabbing=!1,this.canReposition=!1,this.displayingStack=!1,this.displayedStack=null,this.on("hover",this.onHover,this),this.on("updateZoom",this.updateZoom,this),this.app.on("deactivatezoom",this.deactivateZoom,this),this.app.on("activatezoom",this.activateZoom,this),this.app.on("checkcanstack",this.checkCanStack,this),this.app.on("stack",this.stack,this),this.app.on("handlecontrollerrelease",this.handleControllerRelease,this),this.app.on("rearrangefiles",this.rearrangeFiles,this),this.app.on("activatehighlight",this.activateHighlight,this),this.app.on("deactivatehighlight",this.deactivateHighlight,this),this.app.on("reposition",this.reposition,this),this.app.on("updatescroll",this.updateScroll,this),this.app.on("displaystack",this.displayStack,this),this.app.on("showmaingrid",this.showMainGrid,this),this.app.on("hidemaingrid",this.hideMainGrid,this);IMAGE_ASSETS=this.app.assets.findByTag("image"),console.log(IMAGE_ASSETS),STACK_FRAME_MATERIAL=this.app.assets.findByTag("StackFrameMaterial")[0],console.log(STACK_FRAME_MATERIAL),HIGHLIGHT_MATERIAL_HORIZONTAL=this.app.assets.findByTag("HighlightMaterialHorizontal")[0],HIGHLIGHT_MATERIAL_VERTICAL=this.app.assets.findByTag("HighlightMaterialVertical")[0],STACK_COUNTER_FONT=this.app.assets.get(38233344),this.app.assets.add(STACK_COUNTER_FONT),this.app.assets.load(STACK_COUNTER_FONT);var i=this.app.assets.get(38305247);this.app.root.addComponent("sound"),this.app.root.sound.addSlot("tick",{loop:!1,autoPlay:!1,asset:i}),this.app.root.sound.positional=!0;var e=this.app.assets.get(38306341);this.app.root.sound.addSlot("pop",{loop:!1,autoPlay:!1,asset:e});var a=this.app.assets.get(38306598);this.app.root.sound.addSlot("shuffle",{loop:!1,autoPlay:!1,asset:a}),this.testObj=this.app.root.findByName("Test"),this.testObj2=this.app.root.findByName("Test2");var t=Math.ceil(IMAGE_ASSETS.length/NUM_FILES_CIRCUMFERENCE);mainGrid=[];for(var l=0;l<t;l++){mainGrid.push([]);for(var s=0;s<NUM_FILES_CIRCUMFERENCE;s++){mainGrid[l].push({})}}for(var o=IMAGE_ASSETS.length,r=0;r<mainGrid.length;r++){var d=makeRing(r);this.gridAxis.addChild(d);for(var n=0;n<mainGrid[r].length;n++)if(o>0){mainGrid[r][n].hasFile=!0,mainGrid[r][n].file=makeFile(n,r),mainGrid[r][n].file.isStack=!1,d.addChild(mainGrid[r][n].file);var c=mainGrid[r][n].file.getLocalScale();mainGrid[r][n].file.w=c.x,mainGrid[r][n].file.h=c.z,o-=1,mainGrid[r][n].horizHighlightObj=makeHighlightingObjectBetweenFiles(n,r),d.addChild(mainGrid[r][n].horizHighlightObj),mainGrid[r][n].vertHighlightObj=makeHighlightingObjectBetweenFilesVertical(n,r),d.addChild(mainGrid[r][n].vertHighlightObj)}rings.push(d)}curGrid=mainGrid,this.app.fire("object:reload")};var getImageDimensions=function(i,e){return dims={},dims.width=IMAGE_ASSETS[NUM_FILES_CIRCUMFERENCE*e+i].resource.width,dims.height=IMAGE_ASSETS[NUM_FILES_CIRCUMFERENCE*e+i].resource.height,dims},makeRing=function(i){var e=new pc.Entity("ring "+i),a=MIN_RING_Y+i*HEIGHT_FOR_FILE_AND_MARGIN+VERT_FILE_MARGIN/2;return e.setLocalPosition(0,a,0),e},makeFile=function(i,e){var a=new pc.Entity(i+","+e);a.addComponent("model",{type:"plane"}),a.col=i,a.row=e,a.model.meshInstances[0].material=new pc.StandardMaterial,a.model.meshInstances[0].material.diffuseMap=IMAGE_ASSETS[NUM_FILES_CIRCUMFERENCE*e+i].resource,a.model.meshInstances[0].material.update();var t=0,l=0,s=getImageDimensions(i,e),o=s.width/s.height;s.width>s.height?l=(t=MAX_FILE_WIDTH)/o:t=(l=MAX_FILE_HEIGHT)*o,a.setLocalScale(t,1,l);var r=i*HORIZ_DEGREE_BETWEEN_FILES,d=GRID_RADIUS*Math.sin(r),n=GRID_RADIUS*Math.cos(r);return r*=RAD_TO_DEG,a.setLocalPosition(d,0,n),a.setLocalEulerAngles(90,r+180,0),a.tags.add("image"),a.tags.add("file"),a.tags.add("pickable"),a.addComponent("collision",{type:"box",halfExtents:new pc.Vec3(t/2,.04,l/2)}),a},makeHighlightingObjectBetweenFiles=function(i,e){var a=new pc.Entity("HighlightObject,"+i+","+e+",horiz");a.addComponent("model",{type:"plane"}),a.vert=!1,a.horiz=!1,a.col=i,a.row=e,a.model.meshInstances[0].material=HIGHLIGHT_MATERIAL_VERTICAL.resource,a.model.enabled=!1,a.model.meshInstances[0].material.update(),a.setLocalScale(HORIZ_BETWEEN_FILES_HIGHLIGHTING_WIDTH,1,HORIZ_BETWEEN_FILES_HIGHLIGHTING_HEIGHT),a.addComponent("collision",{type:"box",halfExtents:new pc.Vec3(HORIZ_BETWEEN_FILES_HIGHLIGHTING_COLLIDER_WIDTH/2,.04,HORIZ_BETWEEN_FILES_HIGHLIGHTING_COLLIDER_HEIGHT/2)});var t=(i+.5)*HORIZ_DEGREE_BETWEEN_FILES,l=GRID_RADIUS*Math.sin(t),s=GRID_RADIUS*Math.cos(t);return t*=RAD_TO_DEG,a.setLocalPosition(l,0,s),a.setLocalEulerAngles(90,t+180,0),a},makeHighlightingObjectBetweenFilesVertical=function(i,e){var a=new pc.Entity("HighlightObject,"+i+","+e+",vert");a.addComponent("model",{type:"plane"}),a.vert=!0,a.horiz=!1,a.col=i,a.row=e,a.model.meshInstances[0].material=HIGHLIGHT_MATERIAL_HORIZONTAL.resource,a.model.enabled=!1,a.model.meshInstances[0].material.update(),a.setLocalScale(VERT_BETWEEN_FILES_HIGHLIGHTING_WIDTH,1,VERT_BETWEEN_FILES_HIGHLIGHTING_HEIGHT),a.addComponent("collision",{type:"box",halfExtents:new pc.Vec3(VERT_BETWEEN_FILES_HIGHLIGHTING_COLLIDER_WIDTH/2,.04,VERT_BETWEEN_FILES_HIGHLIGHTING_COLLIDER_HEIGHT/2)});var t=HEIGHT_FOR_FILE_AND_MARGIN/2,l=i*HORIZ_DEGREE_BETWEEN_FILES,s=GRID_RADIUS*Math.sin(l),o=GRID_RADIUS*Math.cos(l);return l*=RAD_TO_DEG,a.setLocalPosition(s,t,o),a.setLocalEulerAngles(90,l+180,0),a},getFilePos=function(i,e){var a=i*HORIZ_DEGREE_BETWEEN_FILES;return[GRID_RADIUS*Math.sin(a),0,GRID_RADIUS*Math.cos(a),a*=RAD_TO_DEG]},getFilePosRadius=function(i,e,a){var t=i*HORIZ_DEGREE_BETWEEN_FILES;return[a*Math.sin(t),0,a*Math.cos(t),t*=RAD_TO_DEG]},createStackEntity=function(i,e,a){var t=new pc.Entity(i+","+e);t.addComponent("model",{type:"plane"}),t.col=i,t.row=e,mainGrid[e][i].hasFile=!0,t.model.meshInstances[0].material=STACK_FRAME_MATERIAL.resource,t.model.meshInstances[0].material.update(),t.setLocalScale(MAX_FILE_WIDTH,1,MAX_FILE_HEIGHT),rings[e].addChild(t);var l=getFilePos(i,e),s=l[1],o=l[3],r=l[0],d=l[2];t.setLocalPosition(r,s,d),t.setLocalEulerAngles(90,o+180,0);for(var n=.3*(MAX_FILE_WIDTH/3),c=.3*(MAX_FILE_HEIGHT/3),h=0;h<Math.min(9,a.length);h++){var G=h%3,E=Math.floor(h/3);a[h].reparent(t);var p=0,m=0,I=a[h].w/a[h].h;a[h].w>a[h].h?m=(p=n)/I:p=(m=c)*I,a[h].setLocalScale(p,1,m),a[h].setLocalPosition(.02+n/2+(n+.02)*G-1/3,.1,.02+c/2+(c+.02)*E-1/3),a[h].setLocalEulerAngles(0,0,0)}var _=new pc.Entity("scrn");if(t.addChild(_),_.setLocalEulerAngles(-90,0,0),_.setLocalPosition(.2*MAX_FILE_WIDTH,.1,.2*MAX_FILE_HEIGHT),_.addComponent("element",{type:pc.ELEMENTTYPE_TEXT,anchor:[.5,.5,.5,.5],pivot:[.5,.5],autoWidth:!0,fontSize:.075,text:a.length.toString(),fontAsset:STACK_COUNTER_FONT,opacity:.7}),a.length>9)for(var f=9;f<a.length;f++)a[f].reparent(t),a[f].model.enabled=!1;return t.tags.add("pickable"),t.addComponent("collision",{type:"box",halfExtents:new pc.Vec3(MAX_FILE_WIDTH/2,.04,MAX_FILE_HEIGHT/2)}),t};LoadFiles.prototype.handleControllerRelease=function(i){if(i){if(console.log(i.col,i.row),console.log(i),this.isStackable&&this.focusedFile){var e=i.col,a=i.row;mainGrid[a][e].hasFile=!1;var t,l=this.focusedFile.col,s=this.focusedFile.row,o=mainGrid[s][l].file.isStack;if(mainGrid[s][l].file.isStack?(t=mainGrid[s][l].file.stackFiles,c=mainGrid[s][l].file):(t=[]).push(this.focusedFile),t.push(i),mainGrid[s][l].file=createStackEntity(l,s,t),mainGrid[s][l].file.stackFiles=t,mainGrid[s][l].file.isStack=!0,o&&c.destroy(),this.testObj.setPosition(this.focusedFile.getPosition()),this.displayingStack||this.app.fire("rearrangefiles",e,a),this.displayingStack){for(var r=0;r<mainGrid.length;r++)for(var d=0;d<mainGrid[r].length;d++)mainGrid[r][d].hasFile&&mainGrid[r][d].file.tags.add("pickable");for(var n=0;n<this.displayedStack.stackFiles.length;n++)this.displayedStack.stackFiles[n].name==i.name&&this.displayedStack.stackFiles.splice(n,1);console.log(mainGrid[this.displayedStack.row][this.displayedStack.col].file.isStack);var c=mainGrid[this.displayedStack.row][this.displayedStack.col].file;if(this.displayedStack.stackFiles.length>1){mainGrid[this.displayedStack.row][this.displayedStack.col].file=createStackEntity(this.displayedStack.col,this.displayedStack.row,this.displayedStack.stackFiles),mainGrid[this.displayedStack.row][this.displayedStack.col].file.stackFiles=this.displayedStack.stackFiles,mainGrid[this.displayedStack.row][this.displayedStack.col].file.isStack=!0,mainGrid[this.displayedStack.row][this.displayedStack.col].file.row=this.displayedStack.row,mainGrid[this.displayedStack.row][this.displayedStack.col].file.col=this.displayedStack.col,mainGrid[this.displayedStack.row][this.displayedStack.col].file.name=this.displayedStack.col+" , "+this.displayedStack.row,mainGrid[this.displayedStack.row][this.displayedStack.col].file.reparent(rings[this.displayedStack.row]);var h=(S=getFilePos(this.displayedStack.col,this.displayedStack.row))[1],G=S[3],E=S[0],p=S[2];mainGrid[this.displayedStack.row][this.displayedStack.col].file.setLocalPosition(E,0,p),mainGrid[this.displayedStack.row][this.displayedStack.col].file.setLocalEulerAngles(90,G+180,0)}else{mainGrid[this.displayedStack.row][this.displayedStack.col].file=this.displayedStack.stackFiles[0],mainGrid[this.displayedStack.row][this.displayedStack.col].file.isStack=!1,mainGrid[this.displayedStack.row][this.displayedStack.col].file.row=this.displayedStack.row,mainGrid[this.displayedStack.row][this.displayedStack.col].file.col=this.displayedStack.col,mainGrid[this.displayedStack.row][this.displayedStack.col].file.name=this.displayedStack.col+" , "+this.displayedStack.row,mainGrid[this.displayedStack.row][this.displayedStack.col].file.reparent(rings[this.displayedStack.row]);h=(S=getFilePos(this.displayedStack.col,this.displayedStack.row))[1],G=S[3],E=S[0],p=S[2];mainGrid[this.displayedStack.row][this.displayedStack.col].file.setLocalPosition(E,0,p),mainGrid[this.displayedStack.row][this.displayedStack.col].file.setLocalEulerAngles(90,G+180,0)}c.destroy(),this.displayingStack=!1,this.displayedStack=null,curGrid=mainGrid}i.tags.remove("pickable"),this.focusedFile.tags.remove("pickable"),this.app.fire("object:reload")}else if(this.canReposition)if(this.displayingStack){var m,I;console.log("reposition image in stack");for(d=NUM_FILES_CIRCUMFERENCE-1;d>=0;d--)mainGrid[rings.length-1][d].hasFile&&(m=mainGrid[rings.length-1][d].file.row,I=mainGrid[rings.length-1][d].file.col+1);i.name=I+" , "+m,i.row=m,i.col=I;h=(S=getFilePos(I,m))[1],G=S[3],E=S[0],p=S[2];mainGrid[m][I].file=i,mainGrid[m][I].file.reparent(rings[m]),mainGrid[m][I].file.setLocalPosition(E,0,p),mainGrid[m][I].file.setLocalEulerAngles(90,G+180,0),curGrid=mainGrid;for(r=0;r<mainGrid.length;r++)for(d=0;d<mainGrid[r].length;d++)mainGrid[r][d].hasFile&&mainGrid[r][d].file.tags.add("pickable");for(n=0;n<this.displayedStack.stackFiles.length;n++)this.displayedStack.stackFiles[n].name==i.name&&this.displayedStack.stackFiles.splice(n,1);c=mainGrid[this.displayedStack.row][this.displayedStack.col].file;if(this.displayedStack.stackFiles.length>1){mainGrid[this.displayedStack.row][this.displayedStack.col].file=createStackEntity(this.displayedStack.col,this.displayedStack.row,this.displayedStack.stackFiles),mainGrid[this.displayedStack.row][this.displayedStack.col].file.stackFiles=this.displayedStack.stackFiles,mainGrid[this.displayedStack.row][this.displayedStack.col].file.isStack=!0,mainGrid[this.displayedStack.row][this.displayedStack.col].file.row=this.displayedStack.row,mainGrid[this.displayedStack.row][this.displayedStack.col].file.col=this.displayedStack.col,mainGrid[this.displayedStack.row][this.displayedStack.col].file.name=this.displayedStack.col+" , "+this.displayedStack.row,mainGrid[this.displayedStack.row][this.displayedStack.col].file.reparent(rings[this.displayedStack.row]);h=(S=getFilePos(this.displayedStack.col,this.displayedStack.row))[1],G=S[3],E=S[0],p=S[2];mainGrid[this.displayedStack.row][this.displayedStack.col].file.setLocalPosition(E,0,p),mainGrid[this.displayedStack.row][this.displayedStack.col].file.setLocalEulerAngles(90,G+180,0)}else{mainGrid[this.displayedStack.row][this.displayedStack.col].hasFile=!0,mainGrid[this.displayedStack.row][this.displayedStack.col].file=this.displayedStack.stackFiles[0],mainGrid[this.displayedStack.row][this.displayedStack.col].file.isStack=!1,mainGrid[this.displayedStack.row][this.displayedStack.col].file.row=this.displayedStack.row,mainGrid[this.displayedStack.row][this.displayedStack.col].file.col=this.displayedStack.col,mainGrid[this.displayedStack.row][this.displayedStack.col].file.name=this.displayedStack.col+" , "+this.displayedStack.row,mainGrid[this.displayedStack.row][this.displayedStack.col].file.reparent(rings[this.displayedStack.row]);h=(S=getFilePos(this.displayedStack.col,this.displayedStack.row))[1],G=S[3],E=S[0],p=S[2];mainGrid[this.displayedStack.row][this.displayedStack.col].file.setLocalPosition(E,0,p),mainGrid[this.displayedStack.row][this.displayedStack.col].file.setLocalEulerAngles(90,G+180,0)}c.destroy(),this.displayingStack=!1,this.displayedStack=null,curGrid=mainGrid,this.app.fire("reposition",i)}else this.app.fire("reposition",i);else{var _,f;this.displayingStack?(_=i.colInStack,f=i.rowInStack,this.app.fire("hidemaingrid")):(_=i.col,f=i.row);var S;h=(S=getFilePos(_,f))[1],G=S[3],E=S[0],p=S[2];console.log(S),console.log(this.app.root.sound),this.app.root.sound.play("pop"),mainGrid[f][_].file.setLocalPosition(E,h,p),mainGrid[f][_].file.setLocalEulerAngles(90,G+180,0)}this.focusedFile=null,this.canReposition=!1}else console.log("no releasedEntity!!")},LoadFiles.prototype.showMainGrid=function(){for(var i=0;i<mainGrid.length;i++)for(var e=0;e<mainGrid[i].length;e++)if(mainGrid[i][e].hasFile){(s=getFilePosRadius(e,i,GRID_RADIUS))[1];var a=s[3],t=s[0],l=s[2];mainGrid[i][e].file.setLocalPosition(t,0,l),mainGrid[i][e].file.setLocalEulerAngles(90,a+180,0),mainGrid[i][e].file.setLocalScale(mainGrid[i][e].file.w,1,mainGrid[i][e].file.h),mainGrid[i][e].horizHighlightObj.enabled=!0,mainGrid[i][e].vertHighlightObj.enabled=!0}for(i=0;i<tempStackGrid.length;i++)for(e=0;e<tempStackGrid[i].length;e++)if(tempStackGrid[i][e].hasFile){var s;(s=getFilePosRadius(e,i,2*GRID_RADIUS))[1],a=s[3],t=s[0],l=s[2];tempStackGrid[i][e].file.setLocalPosition(t,0,l),tempStackGrid[i][e].file.setLocalEulerAngles(90,a+180,0),tempStackGrid[i][e].file.setLocalScale(tempStackGrid[i][e].file.w,1,tempStackGrid[i][e].file.h),tempStackGrid[i][e].file.tags.remove("pickable")}},LoadFiles.prototype.hideMainGrid=function(){for(var i=0;i<mainGrid.length;i++)for(var e=0;e<mainGrid[i].length;e++)if(mainGrid[i][e].hasFile){(s=getFilePosRadius(e,i,2*GRID_RADIUS))[1];var a=s[3],t=s[0],l=s[2];mainGrid[i][e].file.setLocalPosition(t,0,l),mainGrid[i][e].file.setLocalEulerAngles(90,a+180,0),mainGrid[i][e].file.setLocalScale(mainGrid[i][e].file.w,1,mainGrid[i][e].file.h),mainGrid[i][e].file.tags.remove("pickable"),mainGrid[i][e].horizHighlightObj.enabled=!1,mainGrid[i][e].vertHighlightObj.enabled=!1}for(i=0;i<tempStackGrid.length;i++)for(e=0;e<tempStackGrid[i].length;e++)if(tempStackGrid[i][e].hasFile){var s;(s=getFilePosRadius(e,i,GRID_RADIUS))[1],a=s[3],t=s[0],l=s[2];tempStackGrid[i][e].file.setLocalPosition(t,0,l),tempStackGrid[i][e].file.setLocalEulerAngles(90,a+180,0),tempStackGrid[i][e].file.setLocalScale(tempStackGrid[i][e].file.w,1,tempStackGrid[i][e].file.h),tempStackGrid[i][e].file.tags.add("pickable")}},LoadFiles.prototype.activateHighlight=function(i){if(this.grabbing&&null===this.highlightObj){var e=i.col,a=i.row;e==this.grabbedEntity.col&&a==this.grabbedEntity.row||e==(this.grabbedEntity.col-1+NUM_FILES_CIRCUMFERENCE)%NUM_FILES_CIRCUMFERENCE&&a==this.grabbedEntity.row||e==this.grabbedEntity.col&&a==(this.grabbedEntity.row-1+NUM_FILES_VERT)%NUM_FILES_VERT||(this.canReposition=!0,i.model.enabled=!0,i.model.meshInstances[0].material.update(),this.highlightObj=i)}},LoadFiles.prototype.deactivateHighlight=function(i){this.canReposition=!1,this.highlightObj&&(this.highlightObj.model.enabled=!1,this.highlightObj.model.meshInstances[0].material.update(),this.highlightObj=null)},LoadFiles.prototype.deactivateZoom=function(i){this.zoomActive=!1,this.grabbing=!0;for(var e=0;e<mainGrid.length;e++)for(var a=0;a<mainGrid[e].length;a++)mainGrid[e][a].hasFile&&(mainGrid[e][a].file.isStack?mainGrid[e][a].file.setLocalScale(MAX_FILE_WIDTH,1,MAX_FILE_HEIGHT):mainGrid[e][a].file.setLocalScale(mainGrid[e][a].file.w,1,mainGrid[e][a].file.h));var t=i.getLocalScale();i.setLocalScale(t.x/1.3,t.y,t.z/1.3),this.grabbedEntity=i},LoadFiles.prototype.activateZoom=function(){this.zoomActive=!0},LoadFiles.prototype.onHover=function(i,e){this.gazeHoverEntity=i,this.gazeHoverPoint.copy(e),this.testObj.setPosition(e.x,e.y,e.z)},LoadFiles.prototype.update=function(i){var e=360*gridHorizOffset;this.gridAxis.setLocalEulerAngles(0,e,0);for(var a=0;a<rings.length;a++)rings[a].getLocalPosition().y>MAX_RING_Y&&rings[a].setLocalPosition(0,MIN_RING_Y+.001,0);if(this.app.xr.camera){var t=this.app.xr.camera.forward;this.gazeVecA.copy(this.cameraEntity.getPosition()),this.gazeVecB.copy(t),this.gazeVecB.scale(10).add(this.gazeVecA);var l=this.cameraEntity.getPosition(),s=new pc.Vec3;s.copy(t),s.scale(GAZE_RAY_LENGTH).add(l),this.app.renderLine(s,this.cameraEntity.getPosition(),new pc.Color(1,10/255,0)),this.app.fire("object:gaze",this,this.gazeVecA,this.gazeVecB)}null!==this.gazeHoverEntity&&this.zoomActive&&this.fire("updateZoom",this.gazeHoverPoint)},LoadFiles.prototype.displayStack=function(i){this.displayedStack=i,console.log("stackEnttiy col row = ",i.col,i.col),console.log("this.displayedStack col row = ",this.displayedStack.col,this.displayedStack.col);var e=Math.ceil(i.stackFiles.length/NUM_FILES_CIRCUMFERENCE);tempStackGrid=[];for(var a=0;a<e;a++){tempStackGrid.push([]);for(var t=0;t<NUM_FILES_CIRCUMFERENCE;t++){tempStackGrid[a].push({})}}for(var l=i.stackFiles.length,s=0;s<tempStackGrid.length;s++){var o=makeRing(s);this.gridAxis.addChild(o);for(var r=0;r<tempStackGrid[s].length;r++)if(l>0){tempStackGrid[s][r].hasFile=!0,tempStackGrid[s][r].file=i.stackFiles[i.stackFiles.length-l],tempStackGrid[s][r].file.tags.add("pickable"),tempStackGrid[s][r].file.reparent(o),tempStackGrid[s][r].file.model.enabled=!0,tempStackGrid[s][r].file.colInStack=r,tempStackGrid[s][r].file.rowInStack=s;(h=getFilePos(r,s))[1];var d=h[3],n=h[0],c=h[2];tempStackGrid[s][r].file.setLocalPosition(n,0,c),tempStackGrid[s][r].file.setLocalEulerAngles(90,d+180,0),tempStackGrid[s][r].file.setLocalScale(tempStackGrid[s][r].file.w,1,tempStackGrid[s][r].file.h),l-=1}tempStackRings.push(o)}for(a=0;a<curGrid.length;a++)for(t=0;t<curGrid[a].length;t++)if(curGrid[a][t].hasFile){var h;(h=getFilePosRadius(t,a,2*GRID_RADIUS))[1],d=h[3],n=h[0],c=h[2];curGrid[a][t].file.setLocalPosition(n,0,c),curGrid[a][t].file.setLocalEulerAngles(90,d+180,0),curGrid[a][t].file.setLocalScale(curGrid[a][t].file.w,1,curGrid[a][t].file.h),curGrid[a][t].file.tags.remove("pickable"),curGrid[a][t].horizHighlightObj.enabled=!1,curGrid[a][t].vertHighlightObj.enabled=!1}this.displayingStack=!0,curGrid=tempStackGrid,this.app.fire("object:reload")},LoadFiles.prototype.rearrangeFiles=function(i,e){this.app.root.sound.play("shuffle");for(var a=i,t=null,l=!1,s=!1,o=e;o<rings.length-1;o++)if(null!==mainGrid[t=o+1][i].file){var r=mainGrid[t][i].file.getLocalPosition(),d=mainGrid[t][i].file.getEulerAngles();mainGrid[o][i].hasFile=!0,mainGrid[o][i].file=mainGrid[t][i].file,mainGrid[t][i].hasFile=!1,mainGrid[t][i].file=null,mainGrid[o][i].file.name=i+","+o,mainGrid[o][i].file.col=i,mainGrid[o][i].file.row=o,mainGrid[o][i].file.reparent(rings[o]),mainGrid[o][i].file.setLocalPosition(r),mainGrid[o][i].file.setEulerAngles(d),l=!0}if(t=rings.length-1,a<NUM_FILES_CIRCUMFERENCE-1&&null!==mainGrid[t][a+1].file){for(var n=0;n<=NUM_FILES_CIRCUMFERENCE-1;n++)if(i<NUM_FILES_CIRCUMFERENCE-1&&null!==mainGrid[t][i+1].file){mainGrid[t][i].hasFile=!0,mainGrid[t][i].file=mainGrid[t][i+1].file,mainGrid[t][i+1].hasFile=!1,mainGrid[t][i+1].file=null,mainGrid[t][i].file.name=i+","+t,mainGrid[t][i].file.col=i,mainGrid[t][i].file.row=t;(p=getFilePos(i,t))[1];var c=p[3],h=p[0],G=p[2];mainGrid[t][i].file.setLocalPosition(h,0,G),mainGrid[t][i].file.setLocalEulerAngles(90,c+180,0),i+=1,s=!0}}else if(a>0&&null!==mainGrid[t][a-1].file)for(n=0;n<=NUM_FILES_CIRCUMFERENCE-1;n++)if(i>0&&null!==mainGrid[t][i-1].file){mainGrid[t][i].hasFile=!0,mainGrid[t][i].file=mainGrid[t][i-1].file,mainGrid[t][i-1].hasFile=!1,mainGrid[t][i-1].file=null,mainGrid[t][i].file.name=i+","+t,mainGrid[t][i].file.col=i,mainGrid[t][i].file.row=t;(p=getFilePos(i,t))[1],c=p[3],h=p[0],G=p[2];mainGrid[t][i].file.setLocalPosition(h,0,G),mainGrid[t][i].file.setLocalEulerAngles(90,c+180,0),i-=1,s=!0}if(i=a,!l)for(o=e;o<rings.length-1;o++)if(null!==mainGrid[t=o+1][i].file){r=mainGrid[t][i].file.getLocalPosition(),d=mainGrid[t][i].file.getEulerAngles();mainGrid[o][i].hasFile=!0,mainGrid[o][i].file=mainGrid[t][i].file,mainGrid[t][i].hasFile=!1,mainGrid[t][i].file=null,mainGrid[o][i].file.name=i+","+o,mainGrid[o][i].file.col=i,mainGrid[o][i].file.row=o,mainGrid[o][i].file.reparent(rings[o]),mainGrid[o][i].file.setLocalPosition(r),mainGrid[o][i].file.setEulerAngles(d),l=!0}if(!s)for(var E=NUM_FILES_CIRCUMFERENCE-1;E>=0;E--)if(mainGrid[t][E].hasFile){mainGrid[t-1][i].hasFile=!0,mainGrid[t-1][i].file=mainGrid[t][E].file,mainGrid[t][E].hasFile=!1,mainGrid[t][E].file=null,mainGrid[t-1][i].file.name=i+","+(t-1),mainGrid[t-1][i].file.col=i,mainGrid[t-1][i].file.row=t-1,mainGrid[t-1][i].file.reparent(rings[t-1]);var p;(p=getFilePos(i,t-1))[1],c=p[3],h=p[0],G=p[2];if(mainGrid[t-1][i].file.setLocalPosition(h,0,G),mainGrid[t-1][i].file.setLocalEulerAngles(90,c+180,0),0===E)console.log("destroying ring!"),rings.pop().destroy(),console.log("ring destroyed.");break}this.displayingStack&&(curGrid=mainGrid,this.displayingStack=!1,this.displayedStack=null)},LoadFiles.prototype.checkCanStack=function(i,e){if(i.isStack)return this.isStackable=!1,void console.log("IS STACK");(n=Math.atan2(e.x,e.z))<0&&(n+=2*Math.PI);var a=n/(2*Math.PI),t=Math.round(a*NUM_FILES_CIRCUMFERENCE)%NUM_FILES_CIRCUMFERENCE;a=(e.y+GRID_HEIGHT/2)/GRID_HEIGHT;var l=Math.round(a*NUM_FILES_VERT)-1;if(!(l<0||l>=mainGrid.length)&&mainGrid[l][t].hasFile){var s=mainGrid[l][t].file;this.closestFile=s;e.distance(s.position);if(s&&s.name!=i.name&&e.distance(s.position)<.5){this.isStackable||this.app.root.sound.play("tick"),this.isStackable=!0,this.app.fire("isstackable",!0),this.focusedFile=s;var o=i.col,r=i.row;mainGrid[r][o].hasFile=!1;this.focusedFile.col,this.focusedFile.row;var d=getFilePosRadius(this.focusedFile.col,this.focusedFile.row,.95*GRID_RADIUS),n=(d[1],d[3]),c=d[0],h=d[2];i.setPosition(c,this.focusedFile.position.y,h),i.setLocalEulerAngles(this.focusedFile.getLocalEulerAngles()),i.setLocalScale(i.w/2,1,i.h/2),this.testObj.setPosition(this.focusedFile.getPosition())}else this.isStackable=!1,this.app.fire("isstackable",!1)}},LoadFiles.prototype.reposition=function(i){this.app.root.sound.play("shuffle");var e=i,a=i.col,t=i.row,l=this.highlightObj.col,s=this.highlightObj.row;console.log("closestCol: "+l),console.log("closestRow: "+s);for(var o,r,d,n,c,h,G,E,p,m=t,I=a,_=l,f=0;f<NUM_FILES_CIRCUMFERENCE-1;f++){if(I===l){a=I;break}(_=I+1)===NUM_FILES_CIRCUMFERENCE&&(_=0),o=0,r=I*HORIZ_DEGREE_BETWEEN_FILES,d=GRID_RADIUS*Math.sin(r),n=GRID_RADIUS*Math.cos(r),r*=RAD_TO_DEG,c=mainGrid[m][I].file.name,(h=new pc.Vec3).copy(mainGrid[m][_].file.getLocalPosition()),G=mainGrid[m][_].file.getLocalEulerAngles(),E=mainGrid[m][I].file.col,mainGrid[m][I].file.name=mainGrid[m][_].file.name,mainGrid[m][I].file.col=mainGrid[m][_].file.col,mainGrid[m][I].file=mainGrid[m][_].file,mainGrid[m][I].file.setLocalPosition(d,o,n),mainGrid[m][I].file.setLocalEulerAngles(90,r+180,0),mainGrid[m][_].file.name=c,mainGrid[m][_].file.col=E,mainGrid[m][_].file=e,mainGrid[m][_].file.setLocalPosition(h),mainGrid[m][_].file.setLocalEulerAngles(G),mainGrid[m][I].hasFile=!0,mainGrid[m][_].hasFile=!0,I=_}m=t,I=l;var S=s;for(f=0;f<NUM_FILES_VERT-1&&m!==s;f++){(S=m+1)==NUM_FILES_VERT&&(S=0),o=0,r=I*HORIZ_DEGREE_BETWEEN_FILES,d=GRID_RADIUS*Math.sin(r),n=GRID_RADIUS*Math.cos(r),r*=RAD_TO_DEG,c=mainGrid[m][I].file.name,h=new pc.Vec3,console.log("destinationRow: "+S),h.copy(mainGrid[S][I].file.getLocalPosition()),G=mainGrid[S][I].file.getLocalEulerAngles(),p=mainGrid[m][I].file.row;var g=rings[S],k=rings[m];mainGrid[m][I].file.name=mainGrid[S][I].file.name,mainGrid[m][I].file.row=mainGrid[S][I].file.row,mainGrid[m][I].file=mainGrid[S][I].file,mainGrid[m][I].file.reparent(k),mainGrid[m][I].file.setLocalPosition(d,o,n),mainGrid[m][I].file.setLocalEulerAngles(90,r+180,0),mainGrid[S][I].file.name=c,mainGrid[S][I].file.row=p,mainGrid[S][I].file=e,mainGrid[S][I].file.reparent(g),mainGrid[S][I].file.setLocalPosition(h),mainGrid[S][I].file.setLocalEulerAngles(G),mainGrid[m][I].hasFile=!0,mainGrid[S][I].hasFile=!0,m=S}this.app.fire("object:reload"),this.app.fire("deactivatehighlight",this.highlightObj)},LoadFiles.prototype.updateScroll=function(i,e){var a=Math.atan2(i.x,i.z),t=Math.atan2(e.x,e.z),l=Math.atan2(i.y,i.z),s=Math.atan2(e.y,e.z);thetaVertDiff=l-s,thetaHorizDiff=a-t,Math.abs(thetaHorizDiff)>1&&(thetaHorizDiff<0?thetaHorizDiff+=2*Math.PI:thetaHorizDiff-=2*Math.PI),gridVertOffset+=1*thetaVertDiff},LoadFiles.prototype.highlightFile=function(i,e){},LoadFiles.prototype.updateZoom=function(i){for(var e=0;e<curGrid.length;e++)for(var a=0;a<curGrid[e].length;a++)if(curGrid[e][a].hasFile){var t=Math.abs(curGrid[e][a].file.getPosition().distance(i));t=Math.min(t,MAX_ZOOM_DISTANCE);var l=-Math.PI*(t/MAX_ZOOM_DISTANCE),s=ZOOM_BASE_MULT*Math.sin(l)+ZOOM_BASE;s=Math.max(MIN_ZOOM_MULT,s),curGrid[e][a].file.isStack?curGrid[e][a].file.setLocalScale(MAX_FILE_WIDTH*s,1,MAX_FILE_HEIGHT*s):curGrid[e][a].file.setLocalScale(curGrid[e][a].file.w*s,1,curGrid[e][a].file.h*s)}};var ApplyOutline=pc.createScript("applyOutline");ApplyOutline.attributes.add("color",{type:"rgba"}),ApplyOutline.attributes.add("thickness",{type:"number",default:1,min:1,max:10,precision:0,title:"Thickness"}),ApplyOutline.prototype.initialize=function(){this.color=new pc.Color(35/255,200/255.5,1),this.thickness=3,this.vec=new pc.Vec3,this.prepare(),window.addEventListener("resize",this.onResize.bind(this)),this.app.on("Ermis:objectOutline:add",function(e){if(e&&e.model&&-1===e.model.layers.indexOf(this.outlineLayer.id)){var t=e.model.layers.slice();t.push(this.outlineLayer.id),e.model.layers=t}},this),this.app.on("Ermis:objectOutline:remove",function(e){var t=e.model.layers.indexOf(this.outlineLayer.id);if(e&&e.model&&t>-1){var i=e.model.layers.slice();i.splice(t,1),e.model.layers=i}},this)},ApplyOutline.prototype.prepare=function(){this.texture=new pc.Texture(this.app.graphicsDevice,{width:this.app.graphicsDevice.width,height:this.app.graphicsDevice.height,format:pc.PIXELFORMAT_R8_G8_B8_A8,autoMipmap:!0,minFilter:pc.FILTER_LINEAR,magFilter:pc.FILTER_LINEAR}),this.renderTarget=new pc.RenderTarget(this.app.graphicsDevice,this.texture,{depth:!0}),this.worldLayer=this.app.scene.layers.getLayerByName("World"),this.outlineLayer=this.app.scene.layers.getLayerByName("OutlineLayer"),this.outlineLayer.renderTarget=this.renderTarget,this.outlineCamera=new pc.Entity,this.outlineCamera.addComponent("camera",{clearColor:new pc.Color(0,0,0,0),layers:[this.outlineLayer.id],fov:this.app.root.findByName("Camera").camera.fov}),this.app.root.addChild(this.outlineCamera),this.outline=new pc.OutlineEffect(this.app.graphicsDevice,this.thickness),this.outline.color=new pc.Color(0,0,1,1),this.outline.texture=this.texture,this.entity.camera.postEffects.addEffect(this.outline)},ApplyOutline.prototype.onResize=function(){this.entity.camera.postEffects.removeEffect(this.outline),this.app.scene.layers.remove(this.outlineLayer),this.texture.destroy(),this.texture=new pc.Texture(this.app.graphicsDevice,{width:this.app.graphicsDevice.width,height:this.app.graphicsDevice.height,format:pc.PIXELFORMAT_R8_G8_B8_A8,autoMipmap:!0,minFilter:pc.FILTER_LINEAR,magFilter:pc.FILTER_LINEAR}),this.renderTarget.destroy(),this.renderTarget=new pc.RenderTarget(this.app.graphicsDevice,this.texture,{depth:!0}),this.outlineLayer.renderTarget=this.renderTarget,this.app.scene.layers.insert(this.outlineLayer,0),this.outline.texture=this.texture,this.entity.camera.postEffects.addEffect(this.outline)},ApplyOutline.prototype.update=function(e){var t=this.entity.getWorldTransform();this.outlineCamera.setPosition(t.getTranslation()),this.outlineCamera.setEulerAngles(t.getEulerAngles()),this.outlineCamera.setLocalScale(t.getScale()),this.outlineCamera.camera.horizontalFov=!(this.app.graphicsDevice.width>this.app.graphicsDevice.height),this.outline.color.copy(this.color)};Object.assign(pc,function(){var e=function(e,t){pc.PostEffect.call(this,e),this.shader=new pc.Shader(e,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+e.precision+" float;","","#define THICKNESS "+t.toFixed(0),"uniform float uWidth;","uniform float uHeight;","uniform vec4 uOutlineCol;","uniform sampler2D uColorBuffer;","uniform sampler2D uOutlineTex;","","varying vec2 vUv0;","","void main(void)","{","    vec4 texel1 = texture2D(uColorBuffer, vUv0);","    float sample0 = texture2D(uOutlineTex, vUv0).a;","    float outline = 0.0;","    if (sample0==0.0)","    {","        for (int x=-THICKNESS;x<=THICKNESS;x++)","        {","            for (int y=-THICKNESS;y<=THICKNESS;y++)","            {    ","                float sample=texture2D(uOutlineTex, vUv0+vec2(float(x)/uWidth, float(y)/uHeight)).a;","                if (sample>0.0)","                {","                    outline=1.0;","                }","            }","        } ","    }","    gl_FragColor = mix(texel1, uOutlineCol, outline * uOutlineCol.a);","}"].join("\n")}),this.color=new pc.Color(1,1,1,1),this.texture=new pc.Texture(e),this.texture.name="pe-outline"};return(e.prototype=Object.create(pc.PostEffect.prototype)).constructor=e,Object.assign(e.prototype,{render:function(e,t,i){var o=this.device,r=o.scope;r.resolve("uWidth").setValue(e.width),r.resolve("uHeight").setValue(e.height),r.resolve("uOutlineCol").setValue(this.color.data),r.resolve("uColorBuffer").setValue(e.colorBuffer),r.resolve("uOutlineTex").setValue(this.texture),pc.drawFullscreenQuad(o,t,this.vertexBuffer,this.shader,i)}}),{OutlineEffect:e}}());var Outline=pc.createScript("outline");Outline.attributes.add("color",{type:"rgb",default:[.5,.5,.5,1],title:"Color"}),Outline.attributes.add("texture",{type:"asset",assetType:"texture",title:"Texture"}),Outline.prototype.initialize=function(){this.effect=new pc.OutlineEffect(this.app.graphicsDevice),this.effect.color=this.color,this.effect.texture=this.texture.resource;var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)}),this.on("destroy",function(){e.removeEffect(this.effect)}),this.on("attr:color",function(e){this.effect.color=e},this),this.on("attr:texture",function(e){this.effect.texture=e?e.resource:null},this)};